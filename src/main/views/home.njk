{% from "govuk/components/summary-list/macro.njk" import govukSummaryList %}
{% from "govuk/components/notification-banner/macro.njk" import govukNotificationBanner %}
{% from "govuk/components/button/macro.njk" import govukButton %}

{% extends "template.njk" %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-two-thirds">
      <h1 class="govuk-heading-xl">HMCTS Case Task Management System</h1>

      {% if not email %}
      <div class="govuk-panel" style="background-color: #1d70b8; color: white; padding: 30px; margin-bottom: 30px;">
        <h2 class="govuk-heading-m" style="color: white; margin-top: 0;">Sign in to get started</h2>
        <p class="govuk-body" style="color: white;">Access your tasks and manage your cases securely.</p>
        <a href="/auth/login" role="button" draggable="false" class="govuk-button govuk-button--start" data-module="govuk-button" style="background-color: white; color: #1d70b8;">
          Sign in
          <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19" viewBox="0 0 33 40" aria-hidden="true" focusable="false">
            <path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z"/>
          </svg>
        </a>
      </div>
      {% else %}
      <div class="govuk-panel govuk-panel--confirmation" style="margin-bottom: 30px;">
        <h2 class="govuk-panel__title">You are signed in</h2>
        <div class="govuk-panel__body">
          {{ email }}
        </div>
      </div>
      {% endif %}

      {% if backendStatus == 'DOWN' %}
      {% set html %}
        <p class="govuk-notification-banner__heading">
          Backend service is currently unavailable at {{ backendUrl }}
        </p>
        <p class="govuk-body">Some features may not work correctly.</p>
      {% endset %}

      {{ govukNotificationBanner({
        type: "error",
        html: html
      }) }}
      {% endif %}

      <p class="govuk-body-l">
        Manage your tasks efficiently with our comprehensive case task management system.
      </p>

      <h2 class="govuk-heading-m">Quick Actions</h2>

      <div class="govuk-grid-row">
        <div class="govuk-grid-column-one-half">
          <div class="govuk-panel" style="background-color: #f3f2f1; padding: 20px;">
            <h3 class="govuk-heading-s">Create New Task</h3>
            <p class="govuk-body-s">Add a new task with title, description, status, and due date.</p>
            <a href="/tasks/create" role="button" draggable="false" class="govuk-button govuk-button--start" data-module="govuk-button">
              Create Task
              <svg class="govuk-button__start-icon" xmlns="http://www.w3.org/2000/svg" width="17.5" height="19" viewBox="0 0 33 40" aria-hidden="true" focusable="false">
                <path fill="currentColor" d="M0 0h13l20 20-20 20H0l20-20z"/>
              </svg>
            </a>
          </div>
        </div>

        <div class="govuk-grid-column-one-half">
          <div class="govuk-panel" style="background-color: #f3f2f1; padding: 20px;">
            <h3 class="govuk-heading-s">View All Tasks</h3>
            <p class="govuk-body-s">See all your tasks in one place with status and priority.</p>
            <a href="/tasks" role="button" draggable="false" class="govuk-button govuk-button--secondary" data-module="govuk-button">
              View Tasks
            </a>
          </div>
        </div>
      </div>

      <h2 class="govuk-heading-m govuk-!-margin-top-6">Features</h2>

      <ul class="govuk-list govuk-list--bullet">
        <li>Create tasks with titles, descriptions, and due dates</li>
        <li>Set task status (Pending, In Progress, Completed, Cancelled)</li>
        <li>Automatic validation for business days (no weekends or bank holidays)</li>
        <li>Priority indicators based on due dates</li>
        <li>Real-time status tracking</li>
      </ul>

      <h2 class="govuk-heading-m">System Status</h2>

      {{ govukSummaryList({
        rows: [
          {
            key: {
              text: "Backend Service"
            },
            value: {
              html: '<strong class="govuk-tag ' + ('govuk-tag--green' if backendStatus == 'UP' else 'govuk-tag--red') + '">' + backendStatus + '</strong>'
            }
          },
          {
            key: {
              text: "API Endpoint"
            },
            value: {
              text: backendUrl
            }
          }
        ]
      }) }}

      <p class="govuk-body govuk-!-margin-top-6">
        <a href="/tasks/create" class="govuk-link">Get started by creating your first task</a>
      </p>
    </div>
  </div>
{% endblock %}
